@page "{id:guid}"
@model Licenta.Pages.Assistant.Messages.Requests.ReviewModel
@{
    ViewData["Title"] = "Review request";
}

@section Styles {
    <link rel="stylesheet" href="~/css/assistant.css" />
}

@if (TempData["StatusMessage"] is string status)
{
    <div class="alert alert-info">@status</div>
}

<h2 class="mb-3">Review request</h2>

<div class="card mb-3">
    <div class="card-body">
        <div class="mb-2"><strong>Patient:</strong> @Model.PatientName</div>
        <div class="mb-2"><strong>Subject:</strong> @Model.Subject</div>
        <div class="mb-2"><strong>Body:</strong> @Model.Body</div>
        <div class="mb-2"><strong>Status:</strong> @Model.Status</div>
        <div class="mb-2"><strong>Assistant:</strong> @Model.AssistantName</div>
        <div class="mb-2"><strong>Doctor:</strong> @Model.DoctorName</div>
        <div class="mb-2"><strong>Created:</strong> @Model.CreatedAtLocal</div>
    </div>
</div>

<div class="d-flex gap-2 flex-wrap mb-4">
    @if (Model.CanAccept)
    {
        <form method="post"
              asp-page-handler="Accept"
              asp-route-id="@Model.Id"
              class="d-inline">
            <button type="submit" class="btn btn-success">
                Accept & open chat
            </button>
        </form>
    }

    @if (Model.CanOpenAssistantChat)
    {
        <a asp-page="/Assistant/Messages/Inbox"
           asp-route-requestId="@Model.Id"
           class="btn btn-outline-primary">
            Open chat with patient
        </a>
    }

    <a asp-page="/Assistant/Messages/Requests/Index"
       class="btn btn-outline-secondary">
        Back
    </a>
</div>

@if (Model.CanEscalate)
{
    <div class="card">
        <div class="card-body">
            <h5 class="mb-3">Escalate to doctor</h5>

            <form method="post" asp-page-handler="Escalate" asp-route-id="@Model.Id">
                <div class="mb-3">
                    <label asp-for="Escalate.DoctorId" class="form-label">Doctor</label>
                    <select asp-for="Escalate.DoctorId" asp-items="Model.Doctors" class="form-select">
                        <option value="">-- Select doctor --</option>
                    </select>
                    <span asp-validation-for="Escalate.DoctorId" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Escalate.Reason" class="form-label">Reason for escalation</label>
                    <textarea asp-for="Escalate.Reason" class="form-control" rows="3"></textarea>
                    <span asp-validation-for="Escalate.Reason" class="text-danger"></span>
                </div>

                <button type="submit" class="btn btn-warning">Send to doctor</button>
            </form>
        </div>
    </div>
}
else if (Model.CanReassign)
{
    <div class="card">
        <div class="card-body">
            <h5 class="mb-3">Reassign to another doctor</h5>

            <form method="post" asp-page-handler="Reassign" asp-route-id="@Model.Id">
                <div class="mb-3">
                    <label asp-for="Escalate.DoctorId" class="form-label">Doctor</label>
                    <select asp-for="Escalate.DoctorId" asp-items="Model.Doctors" class="form-select">
                        <option value="">-- Select doctor --</option>
                    </select>
                    <span asp-validation-for="Escalate.DoctorId" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Escalate.Reason" class="form-label">Reason</label>
                    <textarea asp-for="Escalate.Reason" class="form-control" rows="3"></textarea>
                    <span asp-validation-for="Escalate.Reason" class="text-danger"></span>
                </div>

                <button type="submit" class="btn btn-primary">Reassign</button>
            </form>
        </div>
    </div>
}
else
{
    <div class="alert alert-secondary">No actions available for this request right now.</div>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
