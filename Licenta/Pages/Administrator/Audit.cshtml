@page
@model Licenta.Pages.Administrator.AuditModel
@{
    ViewData["Title"] = "User Logins";
}

<h2 class="mt-4 mb-3 text-center">User Logins</h2>

@if (!Model.Logins.Any())
{
    <div class="alert alert-info text-center">No login events found.</div>
}
else
{
    <div class="row mb-3">
        <div class="col-md-6 mx-auto mb-2">
            <input id="searchInput" class="form-control form-control-lg"
                   type="search" placeholder="Search by user or time..."
                   aria-label="Search logins" autocomplete="off" />
        </div>
        <div class="col-md-2 text-end">
            <form method="post" asp-page-handler="Export">
                <button type="submit" class="btn btn-outline-success">
                    Export CSV
                </button>
            </form>
        </div>
    </div>

    <table id="auditTable" class="table table-striped table-hover text-center align-middle">
        <thead class="table-dark">
            <tr>
                <th>Time</th>
                <th>User</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var e in Model.Logins)
            {
                <tr>
                    <td>@e.Timestamp.ToLocalTime()</td>
                    <td>@e.UserName</td>
                </tr>
            }
        </tbody>
    </table>
}

@section Scripts {
    <script>
        (function () {
            const input = document.getElementById('searchInput');
            const table = document.getElementById('auditTable');
            if (!input || !table) return;

            const rows = Array.from(table.querySelectorAll('tbody tr'));

            function filter() {
                const q = input.value.trim().toLowerCase();
                if (!q) {
                    rows.forEach(r => r.style.display = '');
                    return;
                }
                rows.forEach(r => {
                    const timeText = (r.cells[0]?.innerText || '').toLowerCase();
                    const userText = (r.cells[1]?.innerText || '').toLowerCase();
                    r.style.display = (timeText.includes(q) || userText.includes(q)) ? '' : 'none';
                });
            }

            let t = null;
            input.addEventListener('input', () => {
                clearTimeout(t);
                t = setTimeout(filter, 120);
            });
        })();
    </script>
}
