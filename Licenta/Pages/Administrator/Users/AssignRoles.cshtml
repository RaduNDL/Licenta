@page "{id}"
@model Licenta.Pages.Administrator.Users.AssignRolesModel
@{
    ViewData["Title"] = "Assign Roles";
}
@section Styles {
    <link rel="stylesheet" href="~/css/admin.css" />
}
<h2 class="mb-3">Assign Roles</h2>
<p class="text-muted">User: <strong>@Model.UserEmail</strong></p>

<form method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="UserId" />

    <div class="mb-3">
        @foreach (var r in Model.AllRoles)
        {
            var isChecked = Model.SelectedRoles.Contains(r);
            var isSelf = Model.IsSelf;
            var isAdminRole = string.Equals(r, "Administrator", StringComparison.OrdinalIgnoreCase);

            var disabledAttr = (isSelf && isAdminRole) ? "disabled" : null;

            <div class="form-check">
                <input class="form-check-input"
                       type="checkbox"
                       name="SelectedRoles"
                       value="@r"
                       id="role_@r"
                       @(isChecked ? "checked" : "")
                       @disabledAttr />
                <label class="form-check-label fw-semibold" for="role_@r">@r</label>
            </div>
        }
    </div>

    <div class="d-flex gap-2 mt-3">
        <button type="submit" class="btn btn-primary">
            <i class="bi bi-save"></i> Save
        </button>
        <a asp-page="Index" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back
        </a>
    </div>
</form>

@if (!string.IsNullOrEmpty(Model.Error))
{
    <div class="alert alert-danger mt-3 shadow-sm">
        <strong>Error:</strong> @Model.Error
    </div>
}
@if (!string.IsNullOrEmpty(Model.Status))
{
    <div class="alert alert-success mt-3 shadow-sm">
        @Model.Status
    </div>
}

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll("input[disabled]").forEach(cb => {
                cb.addEventListener("click", e => e.preventDefault());
            });
        });
    </script>
}
